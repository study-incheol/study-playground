[# 1.12. Java-based Container Configuration

> [1.12. Java-based Container Configuration](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java) ì±•í„°ë¥¼ ìš”ì•½í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

## 1.12.1. Basic Concepts: @Bean and @Configuration

Javaì˜ ìƒˆë¡œìš´ êµ¬ì„± ì§€ì› ì„œí¬íŠ¸ í•µì‹¬ì€ @Configuration ê¸°ë°˜ í´ë˜ìŠ¤ì™€ ë©”ì†Œë“œì´ë‹¤.

@Bean ì–´ë…¸í…Œì´ì…˜ì€ Spring Ioc containerì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ìƒˆë¡œìš´ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•˜ê±°ë‚˜ êµ¬ì„±í• ë•Œ ì‚¬ìš©ëœë‹¤. @Component ì£¼ì„ê³¼ í•¨ê»˜ @Bean ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ëŒ€ë¶€ë¶„ @Configuration ì–´ë…¸í…Œì´ì…˜ê³¼ ë” ë§ì´ ì‚¬ìš©ëœë‹¤.

@Configurationì„ ê°€ì§„ í´ë˜ìŠ¤ëŠ” ìµœìš°ì„ ìœ¼ë¡œ ë¹ˆì„ ì •ì˜í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì¸ì§€ëœë‹¤. ë”ìš±ì´, @Configuration í´ë˜ìŠ¤ë“¤ì€ ë™ì¼í•œ í´ë˜ìŠ¤ì˜ ë‹¤ë¥¸ @Bean ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë¹ˆ ê°„ ì¢…ì†ì„±ì„ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. 
ê°€ì¥ ê°„ë‹¨í•œ @Configuration í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 

```java
@Configuration
public class AppConfig {

    @Bean
    public MyService myService() {
        return new MyServiceImpl();
    }
}
```

{% hint style="success" %}

#### ğŸ’¡ Full @Configuration vs "lite" @Bean
@Bean ë©”ì„œë“œê°€ @Configurationìœ¼ë¡œ ì£¼ì„ì„ ë‹¬ì§€ ì•Šì€ í´ë˜ìŠ¤ ë‚´ì—ì„œ ì„ ì–¸ë˜ë©´ "lite" ëª¨ë“œë¡œ ê°„ì£¼ëœë‹¤. ì˜ˆë¥¼ ë“·ì–´, ì„œë¹„ìŠ¤ ì½¤í¬ë„ŒíŠ¸ë“¤ì€ ê° Component í´ë˜ìŠ¤ë“¤ì—ì„œ ì •ì˜ëœ ì¶”ê°€ @Bean ë©”ì†Œë“œë“±ì„ í†µí•´ì„œ ê´€ë¦¬í•˜ëŠ” Viewë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆë‹¤.

@Configurion í´ë˜ìŠ¤ì™€ ë‹¤ë¥´ê²Œ, lite ëª¨ë“œ @Bean ë©”ì„œë“œëŠ” Beanê°„ì˜ ì¢…ì†ì„±ì„ ì„ ì–¸í•  ìˆ˜ ì—†ë‹¤. ëŒ€ì‹ ì—, ê·¸ë“¤ì€ í¬í•¨í•˜ëŠ” êµ¬ì„±ìš”ì†Œì˜ ë‚´ë¶€ ìƒíƒœì™€ ì„ íƒì ìœ¼ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆëŠ” íŒŒë¼ë¯¸í„°ì— ëŒ€í•´ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ì´ëŸ¬í•œ @Bean ë©”ì„œë“œëŠ” ë‹¤ë¥¸ @Bean ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œëŠ” ì•ˆ ëœë‹¤. 
ì´ëŸ¬í•œ ë©”ì„œë“œë“¤ì€ íŠ¹ë³„í•˜ê²Œ ëŸ°íƒ€ì„ì— ë™ì‘í•˜ëŠ”ê²Œ ì•„ë‹ˆê³  íŠ¹ì • ë¹ˆì„ ì°¸ê³ í•˜ê¸° ìœ„í•œ íŒ©í† ë¦¬ ë©”ì†Œë“œ ìš©ë„ë¡œ ì‚¬ìš©ëœë‹¤. ê¸ì •ì ì¸ ë¶€ë¶„ì€ CGLIBì€ í•˜ìœ„ ë¶„ë¥˜ê°€ ëŸ°íƒ€ì„ì— ì ìš©ë  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ ì„¤ê³„ ì¸¡ë©´ì—ì„œ ì œí•œì´ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.

ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ @Bean ë©”ì„œë“œëŠ” @Configuration í´ë˜ìŠ¤ ë‚´ì—ì„œ ì„ ì–¸ë˜ì–´ 'full' ëª¨ë“œê°€ í•­ìƒ ì‚¬ìš©ë˜ê³  êµì°¨ ë©”ì„œë“œ ì°¸ì¡°ê°€ ì»¨í…Œì´ë„ˆì˜ ë¼ì´í”„ì‚¬ì´í´ ê´€ë¦¬ë¡œ ì „í™˜ëœë‹¤. @Bean ë©”ì„œë“œëŠ” ì¼ë°˜ì ì¸ Java í˜¸ì¶œì„ í†µí•´ ì‹¤ìˆ˜ë¡œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ë©°, 
'lite' ëª¨ë“œì—ì„œ ì‘ë™í•  ë•Œ ì¶”ì í•˜ê¸° ì–´ë ¤ìš´ ì‘ì€ ë²„ê·¸ë¥¼ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ëœë‹¤. 

#### ??? ì–´ë–¤ ë²„ê·¸ê°€ ìˆë‹¤ëŠ”ê±¸ê¹Œ?
#### ??? lite ëª¨ë“œ ì‚¬ìš©í•  ì¼€ì´ìŠ¤ëŠ” ì–´ë–¤ê²Œ ìˆì„ê¹Œ?

{% endhint %}


## 1.12.2. Instantiating the Spring Container by Using AnnotationConfigApplicationContext

ë‹¤ìŒ ì„¹ì…˜ì€ Spring 3.0ì— ë„ì…ëœ Springì˜ AnnotationConfigApplicationContextì— ëŒ€í•œ ì„¤ëª…ì´ë‹¤. í•´ë‹¹ ContextëŠ” @Configuration í´ë˜ìŠ¤ë¿ë§Œ ì•„ë‹ˆë¼ JSR-330 ë©”íƒ€ë°ì´í„°ë¡œ ì£¼ì„ì´ ë‹¬ë¦° ì¼ë°˜ @Component í´ë˜ìŠ¤ë„ ìˆ˜ìš©í•  ìˆ˜ ìˆë‹¤.

@Configuration í´ë˜ìŠ¤ê°€ ì…ë ¥ìœ¼ë¡œ ì œê³µë˜ë©´ @Configuration í´ë˜ìŠ¤ ìì²´ê°€ ë¹ˆ ì •ì˜ë¡œ ë“±ë¡ë˜ê³  í´ë˜ìŠ¤ ë‚´ì—ì„œ ì„ ì–¸ëœ ëª¨ë“  @Bean ë©”ì„œë“œë„ ë¹ˆ ì •ì˜ë¡œ ë“±ë¡ëœë‹¤.

@Component ë° JSR-330 í´ë˜ìŠ¤ê°€ ì œê³µë˜ëŠ” ê²½ìš° ë¹ˆìœ¼ë¡œ ì •ì˜ë˜ë©°, í•„ìš”í•œ ê²½ìš° í•´ë‹¹ í´ë˜ìŠ¤ ë‚´ì—ì„œ @Autowired ë˜ëŠ” @Injectì™€ ê°™ì€ DI ë©”íƒ€ë°ì´í„°ê°€ ì‚¬ìš©ë˜ëŠ” ê²ƒìœ¼ë¡œ ê°€ì •í•œë‹¤.

### Simple Construction

ClassPathXmlApplicationContextë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•  ë•Œ Spring XML íŒŒì¼ì´ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒê³¼ ê±°ì˜ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ AnnotationConfigApplicationContextë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•  ë•Œ @Configuration í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(AppConfig.class);
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}
```

ì•ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ AnnotationConfigApplicationContextëŠ” @Configuration í´ë˜ìŠ¤ë¡œë§Œ ì‘ì—…í•˜ëŠ” ê²ƒìœ¼ë¡œ ì œí•œë˜ì§€ ì•ŠëŠ”ë‹¤. 
ì„ì˜ì˜ @Component ë˜ëŠ” JSR-330 ì£¼ì„ì´ ë‹¬ë¦° í´ë˜ìŠ¤ê°€ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ ìƒì„±ìì— ëŒ€í•œ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

```java
public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(MyServiceImpl.class, Dependency1.class, Dependency2.class);
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}
```

ìœ„ì˜ ì˜ˆì—ì„œëŠ” MyServiceImpl, Dependency1 ë° Dependency2ê°€ @Autowiredì™€ ê°™ì€ Spring ì¢…ì†ì„± ì£¼ì… ì£¼ì„ì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•œë‹¤

### Building the Container Programmatically by Using register(Class<?>â€¦â€‹)

AnnotationConfigApplicationContextë¥¼ ìƒì„±í• ë•Œ, ì¸ì ì—†ì´ ìƒì„±í•œ ë‹¤ìŒì— register() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ êµ¬ì„±í•  ìˆ˜ë„ ìˆë‹¤.

```java
public static void main(String[] args) {
    AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
    ctx.register(AppConfig.class, OtherConfig.class);
    ctx.register(AdditionalConfig.class);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.class);
    myService.doStuff();
}
```

### Enabling Component Scanning with scan(Stringâ€¦â€‹)

ì»´í¬ë„ŒíŠ¸ ìŠ¤ìºë‹ í™œì„±í™” í•˜ê¸°ìœ„í•´, @Configuration ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
```java
@Configuration
@ComponentScan(basePackages = "com.acme") 
public class AppConfig  {
    // ...
}
```

ì•ì˜ ì˜ˆì—ì„œ com.acme íŒ¨í‚¤ì§€ëŠ” ê²€ìƒ‰ë˜ì–´ @Component ì£¼ì„ì´ ë‹¬ë¦° í´ë˜ìŠ¤ë¥¼ ì°¾ëŠ”ë‹¤. ì´ëŸ¬í•œ í´ë˜ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ Springbean ì •ì˜ë¡œ ë“±ë¡ëœë‹¤. 
ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ AnnotationConfigApplicationContextëŠ” ë™ì¼í•œ êµ¬ì„±ìš”ì†Œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ í—ˆìš©í•˜ë„ë¡ ê²€ìƒ‰(String...) ë©”ì„œë“œë¥¼ í‘œì‹œí•œë‹¤.

```java
public static void main(String[] args) {
    AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
    ctx.scan("com.acme");
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.class);
}
```

## 1.12.3. Using the @Bean Annotation

### Declaring a Bean

ë¹ˆ ì„ ì–¸í•˜ë ¤ë©´ @Bean ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œì— ì£¼ì„ì„ ë‹¬ì•„ì•¼ í•œë‹¤. ê·¸ëŸ¬ë©´ ApplicationContextì— ë¹ˆ ì •ì˜ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤. 
```java
@Configuration
public class AppConfig {

    @Bean
    public TransferServiceImpl transferService() {
        return new TransferServiceImpl();
    }
}
```

ë˜ëŠ”, ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ ì¸í„°í˜ì´ìŠ¤(ë˜ëŠ” ê¸°ë³¸ í´ë˜ìŠ¤) ë°˜í™˜ ìœ í˜•ì„ ì‚¬ìš©í•˜ì—¬ @Bean ë©”ì„œë“œë¥¼ ì„ ì–¸í•  ìˆ˜ë„ ìˆë‹¤.
```java
public interface BaseConfig {

    @Bean
    default TransferServiceImpl transferService() {
        return new TransferServiceImpl();
    }
}

@Configuration
public class AppConfig implements BaseConfig {

}
```

### Bean Dependencies
@Bean ì–´ë…¸í…Œì´ì…˜ê¸°ë°˜ ë©”ì„œë“œëŠ” ì¢…ì†ì„±ì„ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì„ì˜ë¡œ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

```java
@Configuration
public class AppConfig {

    @Bean
    public TransferService transferService(AccountRepository accountRepository) {
        return new TransferServiceImpl(accountRepository);
    }
}
```

### Receiving Lifecycle Callbacks
@Bean ì£¼ì„ìœ¼ë¡œ ì •ì˜ëœ í´ë˜ìŠ¤ëŠ” ì •ê·œ ë¼ì´í”„ì‚¬ì´í´ ì½œë°±ì„ ì§€ì›í•˜ë©° JSR-250ì˜ @PostConstruct ë° @PreDestroy ì£¼ì„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [JSR-250](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-postconstruct-and-predestroy-annotations) ì£¼ì„ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

ì •ê¸°ì ì¸ ìŠ¤í”„ë§ ë¼ì´í”„ì‚¬ì´í´ ì½œë°±ë„ ì™„ë²½í•˜ê²Œ ì§€ì›ë©ë‹ˆë‹¤. ë¹ˆì´ Initializing Bean, Dispose Bean ë˜ëŠ” Lifecycleì„ êµ¬í˜„í•˜ëŠ” ê²½ìš° ê°ê°ì˜ ë©”ì„œë“œëŠ” ì»¨í…Œì´ë„ˆì— ì˜í•´ í˜¸ì¶œëœë‹¤

@Bean ì£¼ì„ì—ì„œëŠ” Spring XMLì˜ init-method ë° destroy-method ì†ì„±ê³¼ ê°™ì´ ì„ì˜ì˜ ì´ˆê¸°í™” ë° íŒŒê´´ ì½œë°± ë©”ì„œë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```java
public class BeanOne {

    public void init() {
        // initialization logic
    }
}

public class BeanTwo {

    public void cleanup() {
        // destruction logic
    }
}

@Configuration
public class AppConfig {

    @Bean(initMethod = "init")
    public BeanOne beanOne() {
        return new BeanOne();
    }

    @Bean(destroyMethod = "cleanup")
    public BeanTwo beanTwo() {
        return new BeanTwo();
    }
}
```

BeanOneì˜ ê²½ìš° init()ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒë„ ë§ˆì°¬ê°€ì§€ë¡œ ìœ íš¨í•˜ë‹¤. ë‹¤ìŒê³¼ ì˜ˆì œì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
@Configuration
public class AppConfig {

    @Bean
    public BeanOne beanOne() {
        BeanOne beanOne = new BeanOne();
        beanOne.init();
        return beanOne;
    }

    // ...
}
```

### Using the @Scope Annotation

@Bean ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì •ì˜ëœ ë¹ˆì€ íŠ¹ì • ìŠ¤ì½”í”„ê°€ ì§€ì •ë˜ë„ë¡ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

ê¸°ë³¸ ìŠ¤ì½”í”„ëŠ” ì‹±ê¸€í†¤ì´ì§€ë§Œ @Scope ì£¼ì„ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤. 
```java
@Configuration
public class MyConfiguration {

    @Bean
    @Scope("prototype")
    public Encryptor encryptor() {
        // ...
    }
}
```

### @Scope and scoped-proxy
@Scope ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ Javaì—ì„œ ë¹ˆì„ êµ¬ì„±í™”ë©´ proxyMode ì†ì„±ì„ ì œê³µí•œë‹¤. 
ê¸°ë³¸ê°’ì€ ScopedProxyMode.DEFAULT, ì´ê³  ì´ëŠ” ë‹¤ë¥¸ ê¸°ë³¸ê°’ì´ ì•„ë‹Œ í•œ ë²”ìœ„ í”„ë¡ì‹œê°€ ìƒì„±ë˜ì§€ ì•Šì•„ì•¼ í•¨ì„ ëª…ì‹œí•œë‹¤

```java
// an HTTP Session-scoped bean exposed as a proxy
@Bean
@SessionScope
public UserPreferences userPreferences() {
    return new UserPreferences();
}

@Bean
public Service userService() {
    UserService service = new SimpleUserService();
    // a reference to the proxied userPreferences bean
    service.setUserPreferences(userPreferences());
    return service;
}
```

### Customizing Bean Naming
ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ì„± í´ë˜ìŠ¤ëŠ” ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ @Bean ë©”ì„œë“œì˜ ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¬ë‚˜ ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ ì´ë¦„ ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì¬ì •ì˜í•  ìˆ˜ ìˆë‹¤.
```java
@Configuration
public class AppConfig {

    @Bean("myThing")
    public Thing thing() {
        return new Thing();
    }
}
```

### Bean Aliasing
Naming Beansì—ì„œ ì„¤ëª…í•œ ë°”ì™€ ê°™ì´, ë•Œë•Œë¡œ í•˜ë‚˜ì˜ ë¹ˆì— ì—¬ëŸ¬ ê°œì˜ ì´ë¦„ì„ ë¶™ì´ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë³‘ì¹ ì„ ì—¬ëŸ¬ê°œ ì •ì˜í•  ìˆ˜ ìˆë‹¤. 
@Bean ì£¼ì„ì˜ ì´ë¦„ ì†ì„±ì€ ì´ì™€ ê°™ì´ ì„ ì–¸í•  ë•Œ ë°°ì—´ì„ ì‚¬ìš©í•œë‹¤
```java
@Configuration
public class AppConfig {

    @Bean({"dataSource", "subsystemA-dataSource", "subsystemB-dataSource"})
    public DataSource dataSource() {
        // instantiate, configure and return DataSource bean...
    }
}
```

### Bean Description
ë¹ˆì— ëŒ€í•œ ì„¤ëª…ì„ ì²¨ë¶€í•˜ëŠ”ê²ƒì€ ë„ì›€ì´ ë ìˆ˜ ìˆë‹¤. íŠ¹íˆ ë¹ˆì´ ëª¨ë‹ˆí„°ë§ ëª©ì ìœ¼ë¡œ ë…¸ì¶œë  ë•Œ íŠ¹íˆ ìœ ìš©í•˜ë‹¤

```java
@Configuration
public class AppConfig {

    @Bean
    @Description("Provides a basic example of a bean")
    public Thing thing() {
        return new Thing();
    }
}
```

## 1.12.4. Using the @Configuration annotation

@Configuration ì–´ë…¸í…Œì´ì…˜ì€ ë¹ˆì„ ì •ì˜í•  í´ë˜ìŠ¤ë¼ëŠ” ê±¸ ì¸ì§€í•˜ê²Œ í•´ì¤€ë‹¤. 
@Configuration í´ë˜ìŠ¤ì—ì„œ ë©”ì†Œë“œì— @Bean ì–´ë…¸í…Œì´ì…˜ì„ ë©”ì„œë“œì— ì •ì˜í•˜ë©´ ëœë‹¤. 

### Injecting Inter-bean Dependencies

ë¹ˆì´ ì„œë¡œì— ëŒ€í•œ ì¢…ì†ì„±ì„ ê°€ì§ˆ ë•Œ ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ í•´ë‹¹ ì¢…ì†ì„±ì„ í‘œí˜„í•˜ëŠ” ê²ƒì€ í•œ ë¹ˆ ë©”ì„œë“œê°€ ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì²˜ëŸ¼ ê°„ë‹¨í•˜ë‹¤.

```java
@Configuration
public class AppConfig {

    @Bean
    public BeanOne beanOne() {
        return new BeanOne(beanTwo());
    }

    @Bean
    public BeanTwo beanTwo() {
        return new BeanTwo();
    }
}
```

ì•ì˜ ì˜ˆì—ì„œ beanOneì€ ìƒì„±ì ì£¼ì…ì„ í†µí•´ beanTwoì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ìˆ˜ì‹ í•˜ê²Œ ëœë‹¤

### Lookup Method Injection

ì•ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ì¡°íšŒ ë©”ì„œë“œ ì£¼ì…ì€ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì´ë‹¤. ì‹±ê¸€í†¤ ë²”ìœ„ì˜ ë¹ˆì´ í”„ë¡œí† íƒ€ì… ë²”ìœ„ì˜ ë¹ˆì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ì— ìœ ìš©í•˜ë‹¤. 
ë‹¤ìŒ ì˜ˆëŠ” ì¡°íšŒ ë©”ì„œë“œ ì£¼ì…ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤€ë‹¤
```java
public abstract class CommandManager {
    public Object process(Object commandState) {
        // grab a new instance of the appropriate Command interface
        Command command = createCommand();
        // set the state on the (hopefully brand new) Command instance
        command.setState(commandState);
        return command.execute();
    }

    // okay... but where is the implementation of this method?
    protected abstract Command createCommand();
}
```

Java êµ¬ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì¶”ìƒ createCommand() ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ CommandManagerì˜ ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒ ì˜ˆì œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤

```java
@Bean
@Scope("prototype")
public AsyncCommand asyncCommand() {
    AsyncCommand command = new AsyncCommand();
    // inject dependencies here as required
    return command;
}

@Bean
public CommandManager commandManager() {
    // return new anonymous implementation of CommandManager with createCommand()
    // overridden to return a new prototype Command object
    return new CommandManager() {
        protected Command createCommand() {
            return asyncCommand();
        }
    }
}
```

### Further Information About How Java-based Configuration Works Internally

ë‹¤ìŒ ì˜ˆì œì˜ @Bean ì–´ë…¸í…Œì´ì…˜ì„ í™•ì¸í•´ë³´ì

```java
@Configuration
public class AppConfig {

    @Bean
    public ClientService clientService1() {
        ClientServiceImpl clientService = new ClientServiceImpl();
        clientService.setClientDao(clientDao());
        return clientService;
    }

    @Bean
    public ClientService clientService2() {
        ClientServiceImpl clientService = new ClientServiceImpl();
        clientService.setClientDao(clientDao());
        return clientService;
    }

    @Bean
    public ClientDao clientDao() {
        return new ClientDaoImpl();
    }
}
```

clientDoo() ë©”ì„œë“œëŠ” clientService1()ê³¼ clientService2()ì—ì„œ ê°ê° í•œë²ˆì”© í˜¸ì¶œëœë‹¤. ì•„ë§ˆë„ ClientooImpl ì¸ìŠ¤í„´ìŠ¤ëŠ” ê° ë©”ì„œë“œë¥¼ í†µí•´ì„œ ë‘ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ëœë‹¤ê³  ì˜ˆìƒí•  ìˆ˜ ìˆë‹¤.
ê·¸ê²ƒì€ ì˜ëª» ìƒê°ëœ ìƒê°ì´ë‹¤. ìŠ¤í”„ë§ì—ì„œëŠ” ë¹ˆì€ ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€í†¤ì´ê¸° ë•Œë¬¸ì´ë‹¤. ëª¨ë“  @Configuration í´ë˜ìŠ¤ëŠ” CGLIBì„ í†µí•´ì„œ ì„œë¸Œí´ë˜ìŠ¤í™” ëœë‹¤. 
ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ìì‹ ë©”ì„œë“œëŠ” ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  ë¶€ëª¨ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— ë¹ˆë“¤ì„ ìºì‹œí•œë‹¤. 

## 1.12.5. Composing Java-based Configurations

ìŠ¤í”„ë§ì˜ ìë°” ê¸°ë°˜ configuration íŠ¹ì§•ì„ ì‚¬ìš©í•˜ë©´ êµ¬ì„±ì˜ ë³µì¡ì„±ì„ ì¤„ì¼ìˆ˜ ìˆë‹¤. 

### Using the @Import Annotation

<import/> ìš”ì†Œê°€ êµ¬ì„±ì„ ëª¨ë“ˆí™”í•˜ëŠ” ë° ë„ì›€ì´ ë˜ë„ë¡ Spring XML íŒŒì¼ ë‚´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì²˜ëŸ¼ @Import ì£¼ì„ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ ë‹¤ë¥¸ êµ¬ì„± í´ë˜ìŠ¤ì—ì„œ @Bean ì •ì˜ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆë‹¤.

```java
@Configuration
public class ConfigA {

    @Bean
    public A a() {
        return new A();
    }
}

@Configuration
@Import(ConfigA.class)
public class ConfigB {

    @Bean
    public B b() {
        return new B();
    }
}
```

ì´ì œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•  ë•Œ ConfigA.classì™€ ConfigB.classë¥¼ ëª¨ë‘ ì§€ì •í•  í•„ìš” ì—†ì´ ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ ConfigBë§Œ ëª…ì‹œì ìœ¼ë¡œ ì œê³µí•˜ë©´ ëœë‹¤. 

```java
public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(ConfigB.class);

    // now both beans A and B will be available...
    A a = ctx.getBean(A.class);
    B b = ctx.getBean(B.class);
}
```

ì´ ì ‘ê·¼ ë°©ì‹ì€ ìƒì„±í•˜ëŠ” ë™ì•ˆ ì ì¬ì ìœ¼ë¡œ ë§ì€ ìˆ˜ì˜ @Configuration í´ë˜ìŠ¤ë¥¼ ê¸°ì–µí•  í•„ìš” ì—†ì´ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë§Œ ì²˜ë¦¬í•˜ë©´ ë˜ë¯€ë¡œ ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤í™”ë¥¼ ë‹¨ìˆœí™”í•œë‹¤.

### Injecting Dependencies on Imported @Bean Definitions

ì•ì˜ ì˜ˆì œëŠ” ë™ì‘í•˜ì§€ë§Œ ë‹¨ìˆœí•˜ë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ë¹ˆë“¤ì€ ì„œë¡œê°„ì˜ ì¢…ì†ëœ ê²½ìš°ê°€ ë§ë‹¤. @Configuration í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œ Java ì»´íŒŒì¼ëŸ¬ëŠ” ë‹¤ë¥¸ ë¹ˆì— ëŒ€í•œ ì°¸ì¡°ê°€ ìœ íš¨í•œ Java êµ¬ë¬¸ì´ì–´ì•¼ í•œë‹¤ëŠ” ì ì—ì„œ êµ¬ì„± ëª¨ë¸ì— ì œì•½ ì¡°ê±´ì„ ì ìš©í•œë‹¤.
ì´ëŠ” @Bean ì–´ë…¸í…Œì´ì…˜ì— ì„ì˜ì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ì–´ í•´ê²°í•  ìˆ˜ ìˆë‹¤

```java
@Configuration
public class ServiceConfig {

    @Bean
    public TransferService transferService(AccountRepository accountRepository) {
        return new TransferServiceImpl(accountRepository);
    }
}

@Configuration
public class RepositoryConfig {

    @Bean
    public AccountRepository accountRepository(DataSource dataSource) {
        return new JdbcAccountRepository(dataSource);
    }
}

@Configuration
@Import({ServiceConfig.class, RepositoryConfig.class})
public class SystemTestConfig {

    @Bean
    public DataSource dataSource() {
        // return new DataSource
    }
}

public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(SystemTestConfig.class);
    // everything wires up across configuration classes...
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(100.00, "A123", "C456");
}
```

ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì´ ìˆë‹¤. 
@Configurationí´ë˜ìŠ¤ëŠ” ê¶ê·¹ì ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ë¹ˆì´ë¼ëŠ”ê²ƒì„ ê¸°ì–µí•˜ë©´ ëœë‹¤. ì´ëŠ” ê²°êµ­ @Autowired ë° @Value ì£¼ì… ë° ë‹¤ë¥¸ ë¹ˆê³¼ ë™ì¼í•œ ê¸°íƒ€ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•œë‹¤. 

```java
@Configuration
public class ServiceConfig {

    @Autowired
    private AccountRepository accountRepository;

    @Bean
    public TransferService transferService() {
        return new TransferServiceImpl(accountRepository);
    }
}

@Configuration
public class RepositoryConfig {

    private final DataSource dataSource;

    public RepositoryConfig(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Bean
    public AccountRepository accountRepository() {
        return new JdbcAccountRepository(dataSource);
    }
}

@Configuration
@Import({ServiceConfig.class, RepositoryConfig.class})
public class SystemTestConfig {

    @Bean
    public DataSource dataSource() {
        // return new DataSource
    }
}

public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(SystemTestConfig.class);
    // everything wires up across configuration classes...
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(100.00, "A123", "C456");
}
```

### Fully-qualifying imported beans for ease of navigation

ì•ì˜ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ @Autowiredë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì˜ ì‘ë™í•˜ê³  ì›í•˜ëŠ” ëª¨ë“ˆì„±ì„ ì œê³µí•˜ì§€ë§Œ autowired bean ì •ì˜ê°€ ì„ ì–¸ëœ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒì€ ì—¬ì „íˆ ëª¨í˜¸í• ìˆ˜ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ServiceConfigë¥¼ ë³´ê³ ìˆëŠ” ê°œë°œìê°€ @Autowired AccountRepository ë¹ˆì´ ì„ ì–¸ëœ ìœ„ì¹˜ë¥¼ ì •í™•íˆ ì–´ë””ì— ìˆëŠ”ì§€ ê¶ê¸ˆí•´í• ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŠ” ì½”ë“œì— ëª…ì‹œë˜ì–´ ìˆì§€ ì•Šì§€ë§Œ ê´œì°®ì„ ìˆ˜ ìˆë‹¤. 
EclipseëŠ” ëª¨ë“  bean ë“¤ì´ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ê·¸ë˜í”„ë¥¼ ë Œë”ë§ í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¥¼ ì œê³µí•œë‹¤. ë˜í•œ Java IDEëŠ” AccountRepository íƒ€ì…ì˜ ëª¨ë“  ì„ ì–¸ ë° ì‚¬ìš©ì„ ì‰½ê²Œ ì°¾ê³  í•´ë‹¹ ìœ í˜•ì„ ë°˜í™˜í•˜ëŠ” @Bean ë©”ì„œë“œì˜ ìœ„ì¹˜ë¥¼ ë¹ ë¥´ê²Œ í‘œê¸°í•  ìˆ˜ ìˆë‹¤.

ë§Œì•½ ì´ëŸ° ëª¨í˜¸ì„±ì„ í•´ê²°í•´ì£¼ì§€ ì•ŠëŠ” IDEë¼ë©´ @Configuration í´ë˜ìŠ¤ê°„ì— ì§ì ‘ íƒìƒ‰í•˜ë ¤ëŠ” ê²½ìš°, êµ¬ì„± í´ë˜ìŠ¤ ìì²´ë¥¼ ìë™ ì—°ê²°í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ì•¼ í•œë‹¤. 

```java
@Configuration
public class ServiceConfig {

    @Autowired
    private RepositoryConfig repositoryConfig;

    @Bean
    public TransferService transferService() {
        // navigate 'through' the config class to the @Bean method!
        return new TransferServiceImpl(repositoryConfig.accountRepository());
    }
}
```

ìœ„ì™€ ê°™ì€ ìƒí™©ì—ì„œëŠ” AccountRepositoryëŠ” ì™„ì „íˆ ëª…ì‹œì ì´ë‹¤. ê·¸ëŸ¬ë‚˜ ServiceConfigëŠ” RepositoryConfigì™€ ë°€ì ‘í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆë‹¤. 
ì´ê²ƒì€ ì ˆì¶©ì•ˆì´ë‹¤. ê°•í•œ ê²°í•©ì€ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ë˜ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ ê¸°ë°˜ @Configuration í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ëŠ ì •ë„ ì™„í™”í• ìˆ˜ë„ ìˆë‹¤. 

```java
@Configuration
public class ServiceConfig {

    @Autowired
    private RepositoryConfig repositoryConfig;

    @Bean
    public TransferService transferService() {
        return new TransferServiceImpl(repositoryConfig.accountRepository());
    }
}

@Configuration
public interface RepositoryConfig {

    @Bean
    AccountRepository accountRepository();
}

@Configuration
public class DefaultRepositoryConfig implements RepositoryConfig {

    @Bean
    public AccountRepository accountRepository() {
        return new JdbcAccountRepository(...);
    }
}

@Configuration
@Import({ServiceConfig.class, DefaultRepositoryConfig.class})  // import the concrete config!
public class SystemTestConfig {

    @Bean
    public DataSource dataSource() {
        // return DataSource
    }

}

public static void main(String[] args) {
    ApplicationContext ctx = new AnnotationConfigApplicationContext(SystemTestConfig.class);
    TransferService transferService = ctx.getBean(TransferService.class);
    transferService.transfer(100.00, "A123", "C456");
}
```

ì´ì œ ServiceConfigëŠ” DefaultRepositoryConfigë¥¼ í†µí•´ì„œ ëŠìŠ¨í•˜ê²Œ ê²°í•©ë˜ì—ˆë‹¤.  

### Conditionally Include @Configuration Classes or @Bean Methods

íŠ¹ì • ìƒí™©ì— ë”°ë¼ @Configuration í´ë˜ìŠ¤ ë˜ëŠ” ê°œë³„ @Bean ë©”ì„œë“œë¥¼ ì¡°ê±´ë¶€ë¡œ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™”í•˜ëŠ” ê²ƒì€ ì¢…ì¢… ìœ ìš©í•˜ë‹¤. 
ì¼ë°˜ì ì¸ ì˜ˆì œëŠ” @Profile ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ íŠ¹ì • í”„ë¡œíŒŒì¼ í™˜ê²½ì—ë§Œ í™œì„±í™” ì‹œí‚¬ ìˆ˜ ìˆë‹¤. 

@Profile ì–´ë…¸í…Œì´ì…˜ì€ ì‹¤ì œë¡œ @Conditionalì„ í˜¸ì¶œí•´ì„œ ì¢€ë” ìœ ì—°í•˜ê²Œ êµ¬í˜„ëœ ê²ƒì´ë‹¤. @Conditional ì£¼ì„ì€ @Beanì´ ë“±ë¡ë˜ê¸° ì „ì— ì°¸ì¡°í•´ì•¼ í•˜ëŠ” íŠ¹ì • org.springframework.context.annotation.Condition êµ¬í˜„ì„ ì˜ë¯¸í•œë‹¤.

```java
@Override
public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
    // Read the @Profile annotation attributes
    MultiValueMap<String, Object> attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());
    if (attrs != null) {
        for (Object value : attrs.get("value")) {
            if (context.getEnvironment().acceptsProfiles(((String[]) value))) {
                return true;
            }
        }
        return false;
    }
    return true;
}
```

### @Configuration Class-centric Use of XML with @ImportResource

@Configuration í´ë˜ìŠ¤ê°€ ì»¨í…Œì´ë„ˆ êµ¬ì„±ì„ ìœ„í•´ì„œ ìµœì†Œí•œì˜ ì¼ë¶€ XMLì„ ì‚¬ìš©í•´ì•¼í•  ê²½ìš°ê°€ ìˆë‹¤. ì´ë•ŒëŠ” @ImportResourceë¥¼ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ë§Œí¼ì˜ XMLë§Œ ì •ì˜í•  ìˆ˜ ìˆë‹¤. 

```java
@Configuration
@ImportResource("classpath:/com/acme/properties-config.xml")
public class AppConfig {

    @Value("${jdbc.url}")
    private String url;

    @Value("${jdbc.username}")
    private String username;

    @Value("${jdbc.password}")
    private String password;

    @Bean
    public DataSource dataSource() {
        return new DriverManagerDataSource(url, username, password);
    }
}

// properties-config.xml
<beans>
<context:property-placeholder location="classpath:/com/acme/jdbc.properties"/>
</beans>

// jdbc.properties
jdbc.properties
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=
```

